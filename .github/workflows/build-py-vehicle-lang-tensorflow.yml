name: Build py-vehicle-lang-tensorflow

on:
  workflow_call:
  workflow_dispatch:

env:
  DEFAULT_GHC_VERSION: "9.4.4"
  DEFAULT_CABAL_VERSION: "3.10.1.0"

jobs:
  build-py-vehicle-lang-tensorflow:
    strategy:
      matrix:
        os:
          - name: "macOS"
            type: "macos-latest"
          - name: "Linux"
            type: ubuntu-latest
          # 21-11-2022:
          # This test is disabled on Windows due to an issue with TensorFlow.
          # See: https://github.com/vehicle-lang/vehicle/pull/255#issuecomment-1320985019
          # - { version: windows-latest, name: Windows }
        python:
          - version: "3.8"
            tag: "38"
          - version: "3.9"
            tag: "39"
          - version: "3.10"
            tag: "311"

    name: py-vehicle-lang-tensorflow / ${{ matrix.os.name }} - Python ${{ matrix.python.version }}
    runs-on: ${{ matrix.os.type }}

    steps:
      - uses: actions/checkout@v3
        with:
          submodules: true

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python.version }}
          cache: "pip"
          cache-dependency-path: "py-vehicle-lang-tensorflow/pyproject.toml"

      - name: Test
        run: |
          python -m pip install .[test]
          python -m unittest tests/test_LossFunctionTranslation.py
        shell: sh
        working-directory: py-vehicle-lang-tensorflow
